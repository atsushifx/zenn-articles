---
title: "Proxmoxのセットアップ - 構成の概要"
emoji: "💻"
type: "tech"
topics: ["miniPC", "Proxmox", "pve", "diagram", ]
published: true
---

## はじめに

この記事では、自宅で仮想サーバとして使用しているミニPC `Speed S5 Pro` を紹介します。
仮想化ソフトウェアである`Proxmox`を導入し、複数の仮想マシンを同時に稼働させています。
メモリとストレージ(`SSD`/`HDD`)を増設し、上記の仮想マシンをスムーズに運用できます。

## 1. `Proxmox`の概要

### 1.1 `Proxmox`とは

`Proxmox`はオープンソースの仮想化プラットフォームです。
`Debian`をベースにした仮想化専用の`Linuxディストリビューション`で、`Webインタフェース`を通じて簡単にゲストマシンを構築して運用できます。

## 2. 構成

### 2.1 ハードウェア構成

今回購入した`Speed S5 Pro`には、`ゲストOS`を快適に動作させるために、メモリを`64GB`に増設しました。
あわせて、`2TB`の`SATA SSD`と`8TB`の`USB外付けHDD`を追加し、十分に大きなディスク容量にしました。

ハードウェアスペックをまとめると、下記の表となります:

| 種別 | モデル | 詳細 | 備考 |
| --- | --- | --- | --- |
| CPU | `AMD Ryzen 7 5800H` | `8コア` / `16スレッド` | |
| グラフィックス | `AMD Radeon Graphics` | `AMD Cezanne` | 内蔵グラフィックス |
| メモリ | `DDR4` | `64GB` | |
| ストレージ1 | `NVME SSD` | `2TB` | |
| ストレージ2 | `SATA SSD` | `2TB` | |
| `USB外付けHDD` | `USB 3` | `8TB` | |

### 2.2 ネットワーク構成

`Speed S5 Pro`はサーバとして、自宅の`LAN`に繋ぎます。
`PC`や`スマートフォン`は`無線LAN`で繋ぎ、`NAS`や`サーバ`は`有線LAN`で繋ぎます。
以下が`自宅LAN`の構成図です:

![自宅LAN構成図](https://raw.githubusercontent.com/atsushifx/zenn-cli/e4ea3558b73f896fa71399e0791020f3c01a244b/images/atsushifxs-diagram/house-lan.svg)

`IPアドレス`の割り当ては、次のように設定しています:

| `IPアドレス` | 用途 | 備考 |
| --- | --- | --- |
| `192.168.14.10`～`192.168.14.100` | `PC`,スマートフォンなどのデバイス | `DHCP`により動的割り当て |
| `192.168.14.200`～`192.168.14.249` | 自宅サーバ、`NAS`用 | 各デバイスことに固定 |
| `192.168.14.250`～`192.168.14.254` | ルータ用 | 各ルータ用に固定 |

このように、`DHCP`で動的に割り当てるアドレスと、サーバ用に固定で割り当てるアドレスの領域を別にすることにより、`IPアドレス`が衝突しないようにしています。

## 3. セットアップの概要

### 3.1 ディスクキャッシュの使用

ミニPC上には、`SATA`接続の`SSD`と`USB外付け`の`HDD`を追加しています。これらのデバイスは比較的低速なため、高速な`NVME SSD`をディスクキャッシュとして利用します。

ディスクキャッシュツールとして、`Linux`上のブロックデバイス型ディスクキャッシュツール`bcache`を使用します。
`bcache`は、`/dev/sda`などの通常のストレージデバイスの代わりに、キャッシュ済みのストレージデバイス `/dev/bcache#` (#は数字) を提供します。
`/dev/bcache#`上に、ファイルシステムを構築して`Linux`にマウントすることで、通常のストレージと同じように使用できます。

### 3.2 起動ディスクの作成

`USBメモリ`に`Proxmoxインストーラ`の`ISOイメージ`を書き込み、起動ディスクを作成します。
起動ディスクの作成は、`rufus`を使用して、`USBメモリ`に直接`ISOイメージ`を書き込みます。

### 3.3 キーボードとマウス、およびモニター

インストール時には、キーボード、マウス、モニターを接続する必要があります。
キーボードとマウスは有線で`USB`接続するものを、モニターは`HDMI`に対応したものを使用します。
また、USB 接続端子のことを考えると、`USBハブ`があるといいでしょう。

## 技術用語と注

この記事で使用する技術用語を箇条書きにします。

- `Proxmox`:
  `Debian`ベースの`Linuxディストリビューション`で、`Webインタフェース`からゲストマシンを管理・運用できる仮想化プラットフォーム。

- `ゲストOS`:
  仮想化された環境上で動作する`OS`。

- `bcache`:
  `Linux`で動作するブロックデバイス型のディスクキャッシュツール。

- `rufus`:
  `USBメモリ`に`ISOイメージ`を書き込み、起動ディスクを作成できるツール。

- `DHCP`:
  ネットワーク内のデバイスに`IPアドレス`を自動的に割り当てるプロトコル。

- `固定IP`:
  サーバなどのデバイスのために、事前に割り当てられた`IPアドレス`

- `仮想化`:
  ハードウェアリソースを抽象化し、複数の仮想マシンを同時に稼働させる技術。

- `ディスクI/O`:
  ディスクへの入出力

- `起動ディスク`:
  `OS`のインストール時などに使用される、`PC`の起動に必要なデータが格納されたディスク

## おわりに

この記事では、`ミニPC`を自宅サーバとして使用するにあたり、ハードウェアスペックや自宅`LAN`の環境などを説明しました。
`自宅LAN`の環境はそれぞれで異なります。`IPアドレス`の範囲 (`192.168.14.0/24`) や各サーバの`IPアドレス`は自分のところの環境にあわせて変更してください。

それでは、Happy Hacking!

## 参考資料

## Webサイト

- [`proxmox`](https://www.proxmox.com/)
  サーバ用の`仮想化プラットフォーム`

- [`Rufus`](https://rufus.ie/)
  インストールイメージ作成ツール
