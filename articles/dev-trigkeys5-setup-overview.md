---
title: "proxmox: proxmoxのセットアップ #1: Overview"
emoji: "💻"
type: "tech"
topics: ["miniPC", "proxmox", "pve", "diagram", ]
published: false
---

## はじめに

自宅サーバ用にミニPCを購入しました。
`メモリ`,`USB外付けHDD`などを増設し、仮想化アプライアンス`proxmox`を導入しました。
これにより、この`PC`で複数の`OS`を使うことができます。

Enjoy!

## 1. `proxmox`の概要

### 1.1 `proxmox`とは

`proxmox`はオープンソースの仮想化アプライアンスです。
`Debian`をベースにした仮想化専用の`Linuxディストリビューション`で、`Web`インタフェースから簡単にゲストマシンが構築できます。

## 2. 構成

### 2.1 ハードウェア構成

今回購入した`Speed S5 Pro`には、`ゲストOS`を快適に動作させるために、`SSD`とメモリを増設しました。

ハードウェアスペックは、下記の通りです:

| 種別 | モデル | スペック | 備考 |
| --- | --- | --- | --- |
| CPU | `AMD Ryzen 7 5800H` | `8コア` / `16スレッド` | |
| Graphics | `AMD Radeon Graphics` | `AMD Cezanne` | 内蔵グラフィックス |
| メモリ | `DDR4` | `64GB` | |
| ストレージ1 | `NVME SSD` | `2TB` | |
| ストレージ2 | `SATA SSD` | `2TB` | |
| USB外付け`HDD` | `USB 3` | `8TB` | |

### 2.2 ネットワーク構成

`Speed S5 Pro`は、自宅の`LAN`に繋ぎます。
自分の`PC`や`スマートフォン`は`無線LAN`で繋ぎますが、`NAS`などは`有線LAN`で繋ぎます。
以下が自宅 LAN の構成図です:

![自宅LAN構成図](https://raw.githubusercontent.com/atsushifx/zenn-cli/e4ea3558b73f896fa71399e0791020f3c01a244b/images/atsushifxs-diagram/house-lan.svg)
*LAN構成図*

`IPアドレス`は、`1`～`100`を`DHCP`用に、`200`～をサーバなどの`固定IP`用に確保しています。
とくに、`251`～`254`はルータ用として確保しています。

このように、`DHCP`で動的に割り当てるアドレスと、サーバ用に固定で割り当てるアドレスの領域を別にすることにより、`IPアドレス`が衝突しないようにしています。

## 3. セットアップの概要

### 3.1 ディスクキャッシュの使用

システムの`ディスクI/O`の速度を向上させるため、`NVME SSD`をディスクキャッシュとして利用します。

ディスクキャッシュ用のツールとして`bcache`を使用します。
`bcache`は、通常の`/dev/sda/,'/dev/sdb`のようなデバイスの代わりに、`/dev/bcache#` (#には、数字がはいる) を作成します。

`/dev/bcache#`は、ディスクキャッシュ付きのストレージデバイスとして扱えます。
`Linux`側では、ストレージとして`/dev/bcache#`を割り当てることで、`/dev/sda`を割り当てたときと同様に、ストレージを扱えます。

### 3.2 起動ディスクの作成

`USBメモリ`に`proxmoxインストーラ`の`ISOイメージ`を書き込み、起動ディスクを作成します。

起動ディスクの作成は、`rufus`を使用して、`マイクロSD`に直接`ISOイメージ`を書き込みます。

### 3.3 キーボードとマウス、およびモニター

インストール時には、キーボード、マウス、モニターを接続する必要があります。
キーボードとマウスは有線で`USB`接続するものを、モニターは`HDMI`に対応したものを使用します。
また、USB 接続端子のことを考えると、`USBハブ`があるといいでしょう。

## 技術用語と注

この記事で使用する技術用語を箇条書きにします。

- `proxmox`:
  `Debian`ベースの`Linuxディストリビューション`で、`Webインタフェース`で管理できる仮想化アプライアンス。

- `ゲストOS`:
  仮想化環境において、仮想化環境上で動作する`OS`。

- `bcache`:
  `Linux`で動作するブロックデバイス型のディスクキャッシュツール。

- `rufus`:
  `Windows`で使用できる、`USBメモリ`に`ISOイメージ`を書き込み、起動ディスクを作成するツール。

- `DHCP`:
  ネットワーク内のデバイスに`IPアドレス`を自動的に割り当てるプロトコル。

- `固定IP`:
  事前に決められた`IPアドレス`。

- `仮想化`:
  ハードウェア資源を抽象化し、仮想化環境を構築する技術。

- `ディスクI/O`:
  ディスクへの入出力

- `起動ディスク`:
  `OS`のインストール時などに使用される、`PC`の起動に必要なデータが格納されたディスク

## おわりに

この記事では、`ミニPC`を自宅サーバとして使用するにあたり、ハードウェアスペックや自宅`LAN`の環境などを説明しました。
`自宅LAN`の環境はそれぞれの家で異なります。`IPアドレス`の領域 (`192.168.14.0/24`) や各サーバの`IP アドレス`は自分のところの環境にあわせて変更してください。

それでは、Happy Hacking!
